{% extends "base.html" %}

{% block content %}
<h1>BGP Manager</h1>

<hr>

<form method="POST" action="{{ url_for('bgp_manager_bp.bgp_manager_session') }}" autocomplete="on">
    {{ form.hidden_tag() }}

    <div class="row mb-3">
        <div class="col">{{ form.hostname(class="form-control") }}</div>
    </div>

    <div class="row g-3">
        <div class="col-2">{{ form.action(class="form-control") }}</div>
        <div class="col-3">{{ form.group(class="form-control") }}</div>
        <div class="col">{{ form.neighbor(class="form-control") }}</div>
    </div>

    <small class="text-muted">f'{action} protocols bgp group {group} neighbor {neighbor}'</small>

    <br>

    {{ form.submit(class="btn btn-primary mb-3 mt-3") }}

</form>


<pre class="border border-3 rounded-3 p-3">{{ output }}</pre>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let groupSelect = document.getElementById("group");
        let neighborSelect = document.getElementById("neighbor");

        groupSelect.addEventListener("change", function () {
            let selectedGroup = this.value;

            fetch("{{ url_for('bgp_manager_bp.get_neighbors') }}", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ group: selectedGroup })
            })
                .then(response => response.json())
                .then(data => {
                    console.log("ðŸ“¡:", data);
                    neighborSelect.innerHTML = "<option value=''>Chose a Neighbor</option>";
                    data.forEach(item => {
                        let option = document.createElement("option");
                        option.value = item.neighbor;
                        option.textContent = item.description;
                        neighborSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    alert("Erro ao carregar vizinhos. Tente novamente.");
                });

        });
    });
</script>
{% endblock %}