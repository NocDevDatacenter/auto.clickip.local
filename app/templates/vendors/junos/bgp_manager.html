{% extends "base.html" %}

{% block content %}
<h1>BGP Manager</h1>

<hr>

<form method="POST" action="{{ url_for('bgp_manager_bp.bgp_manager_session') }}" autocomplete="on">
    {{ form.hidden_tag() }}

    <div class="row mb-3">
        <div class="col">
            <div class="form-floating">
                {{ form.hostname(class="form-control") }}
                {{ form.hostname.label }}
            </div>
        </div>
    </div>

    <div class="row g-3 mb-3">
        <div class="col-2">
            <div class="form-floating">
                {{ form.action(class="form-control") }}
                {{ form.action.label }}
            </div>
        </div>
        <div class="col-4">
            <div class="form-floating">
                {{ form.group(class="form-control") }}
                {{ form.group.label }}
            </div>
        </div>
        <div class="col">
            <div class="form-floating">
                {{ form.neighbor(class="form-control") }}
                {{ form.neighbor.label }}
            </div>
        </div>
    </div>

    {{ form.submit(class="btn btn-primary mb-3") }}

</form>


<small class="text-muted">f'{action} protocols bgp group {group} neighbor {neighbor}'</small>
<pre class="border border-3 rounded-3 p-3">{{ output }}</pre>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let groupSelect = document.getElementById("group");
        let neighborSelect = document.getElementById("neighbor");

        groupSelect.addEventListener("change", function () {
            let selectedGroup = this.value;

            fetch("{{ url_for('bgp_manager_bp.get_neighbors') }}", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ group: selectedGroup })
            })
                .then(response => response.json())
                .then(data => {
                    console.log("ðŸ“¡:", data);
                    neighborSelect.innerHTML = "<option value=''>Chose a Neighbor</option>";
                    data.forEach(item => {
                        let option = document.createElement("option");
                        option.value = item.neighbor;
                        option.textContent = item.description;
                        neighborSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    alert("Erro ao carregar vizinhos. Tente novamente.");
                });
        });
    });
</script>
{% endblock %}